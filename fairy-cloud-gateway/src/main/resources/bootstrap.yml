spring:
  cloud:
    nacos:
      username: nacos
      password: nacos
      discovery:
        server-addr: node01:8848
        namespace: d98a5ebc-15cd-41b6-bdb0-225760f2c50d
      config:
        server-addr: node01:8848
        file-extension: yml
        namespace: d98a5ebc-15cd-41b6-bdb0-225760f2c50d
        refresh-enabled: true
        enabled: true
    sentinel:
      transport:
        port: 8720
        dashboard: node01:8084
      datasource:
        # 名称随意
        gw-flow:
          nacos:
            server-addr: node01:8848
            dataId: ${spring.application.name}-flow
            groupId: SENTINEL_GROUP
            rule-type: gw-flow
            namespace: d98a5ebc-15cd-41b6-bdb0-225760f2c50d
            #默认json格式
            dataType: json
            username: nacos
            password: nacos
        gw-api-group:
          nacos:
            server-addr: node01:8848
            dataId: ${spring.application.name}-api
            groupId: SENTINEL_GROUP
            rule-type: gw-api-group
            namespace: d98a5ebc-15cd-41b6-bdb0-225760f2c50d
            #默认json格式
            dataType: json
            username: nacos
            password: nacos
    gateway:
      httpclient:
        pool:
          max-idle-time: 10000
      discovery:
        locator:
          lower-case-service-id: true
          enabled: true
      enabled: true
      routes:
        - id: fairy-cloud-auth
          uri: lb://fairy-cloud-auth
          predicates:
            - Path=/auth/**
#          filters:
#            - StripPrefix=1
        - id: fairy-cloud-member
          uri: lb://fairy-cloud-member
          predicates:
            - Path=/member/**
        - id: fairy-cloud-stock
          uri: lb://fairy-cloud-stock
          predicates:
            - Path=/stock/**
        - id: fairy-cloud-order
          uri: lb://fairy-cloud-order
          predicates:
            - Path=/order/**
        - id: fairy-cloud-product
          uri: lb://fairy-cloud-product
          predicates:
            - Path=/pms/**
        - id: fairy-cloud-portal
          uri: lb://fairy-cloud-portal
          predicates:
            - Path=/portal/**
      default-filters:
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY
        - AddResponseHeader=X-Response-Default-Foo, Default-Bar
            - name: RequestRateLimiter
            args:
              redis-rate-limiter.replenishRate: 2  #流速 每秒
              redis-rate-limiter.burstCapacity: 10   #令牌桶的容积
              rate-limiter: "#{@defaultRedisRateLimiter}"  #SPEL表达式去的对应的bean
              key-resolver: "#{@apiKeyResolver}" #SPEL表达式去的对应的bean
#是否开启@SentinelRestTemplate注解
resttemplate:
  sentinel:
    enabled: true

feign:
  sentinel:
    enabled: true
  okhttp:
    enabled: true

jetcache:
  statIntervalMinutes: 1
  areaInCacheName: false
  hidePackages: com.springboot.cloud
  local:
    # 默认永久本地缓存
    default:
      type: caffeine
      keyConvertor: fastjson
  remote:
    # 默认永久的远程缓存
    default:
      type: redis
      keyConvertor: fastjson
      valueEncoder: kryo
      valueDecoder: kryo
      poolConfig:
        minIdle: 5
        maxIdle: 20
        maxTotal: 50
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
